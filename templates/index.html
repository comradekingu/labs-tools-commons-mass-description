<!-- Blue color = #337ab7 -->
<!DOCTYPE HTML>
<html lang="cs">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Commons mass description filler</title>
		<!-- font awesome -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<style>
			.hidden {
			display: none !important;
			visibility: hidden !important;
			}
			.carousel-inner {
			width: 1280px;
			height: 720px;
			}
			.carousel-caption {
			font-size: 45px;
			}
			.alert {
				margin-top:20px;
				width: 1280px;
			}
		</style>
	</head>
	<body>
		<!-- navbar -->
		<nav class="navbar navbar-inverse bg-faded" style="background-color:#337ab7;border-color: 2e6da4">
			<div class="container-fluid">
				<div class="row" style="padding-left: 15px">
					<div class="col">
						<a class="navbar-brand" href="#" style="color: #fff">
						Commons mass description filler
						</a>
					</div>
					<div class="col" style="float: right">
						{% if username %}
						<a class="navbar-brand" href="#" style="color: #fff">{{ username }}</a>
						<a class="navbar-brand" href="{{ url_for('logout') }}" style="color: #fff">logout</a>
						{% else %}
						<a class="navbar-brand" href="{{ url_for('login') }}" style="color: #fff">login</a>
						{% endif %}
					</div>
				</div>
			</div>
		</nav>
		{% if username %}
		<div class="container">
		<div class="row">
		<div class="col">
			<!-- Carousel -->
			<div id="maincarousel" class="carousel slide" data-ride="carousel" data-interval="false">
				<!-- Wrapper for slides -->
				<div class="carousel-inner">
					<div class="item active firstSlide">
						<img src="https://placehold.it/1280x720">
						<div class="carousel-caption">
							test
						</div>
					</div>
					<div class="listovani">
						<!-- Controls -->
						<a class="left carousel-control" href="#maincarousel" role="button" data-slide="prev">
						<span class="glyphicon glyphicon-chevron-left"></span>
						</a>
						<a class="right carousel-control" href="#maincarousel" role="button" data-slide="next">
						<span class="glyphicon glyphicon-chevron-right"></span>
						</a>
					</div>
				</div>
				<!-- End Carousel -->
			</div>
			<div id="hs" class="hidden">
				<div class="col">
					<div class="alert alert-danger alert-dismissible hidden">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					  <strong>Saving failed!</strong> There was an unexpected error. Please continue with describing another images.
					</div>
					<div class="alert alert-success alert-dismissible hidden">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					  <strong>Saved!</strong> Your edit was sucessfully saved.
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="description">Description</label>
						<textarea class="form-control" rows="2" style="width: 1280px" id="descript"></textarea>
					</div>
				</div>
				<div class="col">
					<button class="btn btn-primary submit">Submit</button>
				</div>
			</div>
		</div>
		{% else %}
		<div class="container">
			<center>
				<h1>Please <a href='login'>log in</a>.</h1>
			</center>
		</div>
		{% endif %}
		<script>
			var data_offset = 0;
			var removeFirstSlide = false;

			addDescription = function() {

				var desc = $('#descript').val();
				$('#descript').val('');
				if(desc != "")
				{
					//add class remove to remove this element after trigger click on .right
					$('.active').addClass('remove');
					$(".right").click();
					$( ".remove" ).remove();

					//escape spaces
					for (p in desc)
					{
						if( p == " ")
						{
							p = "%20";
						}
					}

					data = desc;
					$.get("https://tools.wmflabs.org/commons-mass-description/edit?image=User:Martin_Urbanec/sand&description=" + data, function ( json ) {
						//console.log(json['status']);
						if(json['status'] == 'ok')
						{
							console.log('edited');
							$('.alert-success').removeClass('hidden');
							setTimeout(fade_out, 3000);
						}else {
							console.log('error');
							$('.alert-danger').removeClass('hidden');
						}
					});
				}
			};

			getItems = function() {
			  console.log(data_offset);
			  $.get("https://tools.wmflabs.org/commons-mass-description/images?offset=" + data_offset, function( json ) {
			    for (var i = 0; i < json.length; i++) {
			      if(i != 9){
			        addItemToCarousel(json[i]['url'], json[i]['title'], false);
			      }
			      else {
			        addItemToCarousel(json[i]['url'], json[i]['title'], true);
			      }
			    }
			  });
			};
			addItemToCarousel = function(url, caption, lastElement) {
			  if (lastElement == true) {
			    $( "<div class=\"item lastElement\"><img src=\"" + url + "\"><div class=\"carousel-caption width=\"1280\" height=\"720\" \">" + caption + "</div></div>" ).insertBefore( ".listovani" );
			  }else {
			    $( "<div class=\"item\"><img src=\"" + url + "\"><div class=\"carousel-caption width=\"1280\" height=\"720\" \">" + caption + "</div></div>" ).insertBefore( ".listovani" );
			  }
			};

			checkLast = function() {
			  var temp = $('.active');
			  if (temp.hasClass('lastElement') == true)
			  {
			    $('.active').removeClass('lastElement');
			    getItems();
			  }
			}

			offset = function(left_or_right) {
			  if(left_or_right == "+") {
			    data_offset += 1;
			  }else if(left_or_right == "-") {
			    data_offset -= 1;
			  }
			}

			function fade_out() {
  			$(".alert-success").fadeOut().empty();
			}

			$( document ).ready(function() {

			 	$('#maincarousel').carousel({ interval: 500, wrap: false });
			  $('#maincarousel').carousel('pause');
			  getItems();
			  $( ".submit" ).click(function() {
			     addDescription();
			  });

			  //handle carousel clicks
			  $(".left").click(function () {
			    offset("-");
			  });

			  $(".right").click(function () {
			    checkLast();
			    offset("+");
					//remove first slide
					$("#hs").removeClass('hidden');
					//$(".firstSlide").hide();
					if (removeFirstSlide == true)
					{
						//$(".firstSlide").remove();
						$("div.firstSlide").remove()
					}
					removeFirstSlide = true;
			  });

			});
		</script>
	</body>
</html>
